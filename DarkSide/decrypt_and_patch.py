from util import pe_handle, decrypt_block, decrypt

text_section = pe_handle.sections[0].get_data()
tstart = pe_handle.sections[0].PointerToRawData
decrypted_text_section = decrypt(text_section, len(text_section))

print('[+] the encrypted text section was successfully decrypted')

data_section = pe_handle.sections[3].get_data().split(b'\xff'*4)[0]
dstart = pe_handle.sections[3].PointerToRawData
decrypted_data_section = decrypt(data_section, len(data_section))

print('[+] the encrypted data section was successfully decrypted')

with open('06355667ea0deef9cfeedc864d74edfe986cf9a9f129532f4a442f7098e1e054', 'rb') as f1:
    with open('06355667ea0deef9cfeedc864d74edfe986cf9a9f129532f4a442f7098e1e054_patched', 'wb') as f2:
        f2.write(f1.read())
        f2.seek(tstart)
        f2.write(decrypted_text_section)
        f2.seek(dstart)
        f2.write(decrypted_data_section)

print('[+] the binary was successfully patched')